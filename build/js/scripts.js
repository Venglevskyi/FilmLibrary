"use strict";var popularityRefs={filmsList:document.querySelector(".films-list"),homePage:document.querySelector(".homepage"),detailsPage:document.querySelector(".detailsPage"),libraryPage:document.querySelector(".library"),libraryList:document.querySelector(".library-btn"),libraryListLi:document.querySelector(".library-films-list"),btnPrev:document.querySelector(".pagination__btn--prev"),pagPage:document.querySelector(".pagination__page"),btnNext:document.querySelector(".pagination__btn--next"),searchForm:document.querySelector(".searchform"),homePageBtn:document.querySelector(".home-btn")},popularityFilms="https://api.themoviedb.org/3/discover/movie?sort_by=popularity.desc&api_key=bd2cd46f09d0c01b4fe8699d010953c1&language=ru",popularFilmsData={page:1,copyDomElement:"",flag:!1,getDataPopularFilms:function(){fetch("".concat(popularityFilms,"&page=").concat(this.page)).then(function(t){return t.json()}).then(function(t){return parseData(t.results)}).catch(function(t){return console.error(t)})}};document.addEventListener("DOMContentLoaded",popularFilmsData.getDataPopularFilms()),popularityRefs.homePageBtn.addEventListener("click",function(){return location.reload()}),popularityRefs.btnPrev.addEventListener("click",prevPage),popularityRefs.btnNext.addEventListener("click",nextPage),popularityRefs.libraryList.addEventListener("click",toLibrary);var serchUrl="https://api.themoviedb.org/3/search/movie?api_key=bd2cd46f09d0c01b4fe8699d010953c1&language=ru&query=",serchRefs={input:document.querySelector(".searchform__field__input"),output:document.querySelector(".films-list")},findSettings={page:1,serchQuery:"",searchFromDB:function(t){fetch("".concat(serchUrl).concat(t,"&page=").concat(this.page)).then(function(t){return t.json()}).then(function(t){return parseData(t.results)}).catch(function(t){return console.error(t)})}};function getInputValue(t){t.preventDefault();var e=t.srcElement.value;findSettings.serchQuery=e,0!==findSettings.serchQuery.length?findSettings.searchFromDB(e):popularFilmsData.getDataPopularFilms()}function renderFilmSerchList(t){serchRefs.output.insertAdjacentHTML("afterbegin",t)}serchRefs.input.addEventListener("input",getInputValue);var pageRefs={pagPage:document.querySelector(".pagination__page span"),detailsPage:document.querySelector(".detailsPage")};function prevPage(){popularFilmsData.flag&&(clearList(),pageRefs.detailsPage.classList.toggle("hidden"),popularityRefs.homePage.classList.toggle("hidden"),popularFilmsData.getDataPopularFilms()),1<findSettings.page&&(findSettings.page-=1,pageRefs.pagPage.textContent=findSettings.page,findSettings.searchFromDB(findSettings.serchQuery)),1<popularFilmsData.page&&(popularFilmsData.page-=1,pageRefs.pagPage.textContent=popularFilmsData.page,popularFilmsData.getDataPopularFilms(),window.scrollTo({top:0,left:0,behavior:"auto"}))}function nextPage(){1<=findSettings.serchQuery.length?(findSettings.page+=1,pageRefs.pagPage.textContent=findSettings.page,findSettings.searchFromDB(findSettings.serchQuery)):(popularFilmsData.page+=1,pageRefs.pagPage.textContent=popularFilmsData.page,popularFilmsData.getDataPopularFilms(),window.scrollTo({top:0,left:0,behavior:"auto"}))}function toLibrary(t){t.preventDefault(),popularityRefs.homePage.classList.add("hidden"),popularityRefs.detailsPage.classList.add("hidden"),popularityRefs.libraryPage.classList.remove("hidden");var e=localStorage.getItem("library");if(e){var a=e.split(",").filter(function(t){return""!==t});Promise.all(a.map(function(t){return fetch("".concat("https://api.themoviedb.org/3/movie/").concat(t).concat("?api_key=bd2cd46f09d0c01b4fe8699d010953c1&language=ru")).then(function(t){return t.json()})})).then(function(t){renderLibrary(t),document.querySelector(".library__empty-list").remove()})}}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}pageRefs.detailsPage.addEventListener("click",prevPage);var refsFilmData={userInput:document.querySelector(".films-list"),body:document.querySelector("body")};function getUserInput(t){t.target.dataset.id!==t.currentTarget.dataset.id&&getData(t.target.dataset.id)}refsFilmData.userInput.addEventListener("click",getUserInput);var baseUrl="https://api.themoviedb.org/3/movie/",apiKey="?api_key=bd2cd46f09d0c01b4fe8699d010953c1&language=ru",imgFilmUrl="https://image.tmdb.org/t/p/w500";function getData(t){fetch("".concat(baseUrl).concat(t).concat(apiKey)).then(function(t){return t.json()}).then(function(t){return parseFilmData(t)}).catch(function(t){return console.error(t)})}function parseFilmData(t){var e='\n    <div class="detailsPage-description container">\n\n    <img class="poster" src="'.concat(imgFilmUrl).concat(t.poster_path,'" alt="film-poster" />\n\n    <div class="film-info">\n    <h2 class="film-info__headline">').concat(t.title,"</h2>\n    <table>\n    <tr>\n    <td>vote / votes</td>\n    <td>").concat(t.vote_average," / ").concat(t.vote_count,"</td>\n    </tr>\n    <tr>\n    <td>original title</td>\n    <td>").concat(t.original_title,"</td>\n    </tr>\n    <tr>\n    <td>popularity</td>\n    <td>").concat(t.popularity,"</td>\n    </tr>\n    <tr>\n    <td>genre</td>\n    <td>").concat(t.genres[0].name,'</td>\n    </tr>\n    </table>\n    <p class="film-info__title">About</p>\n    <p class="film-info__about">\n    ').concat(t.overview,'\n    </p>\n    </div>\n    </div>\n    <div class="pagination container">\n    <button class="pagination__btn--prev" type="button">\n      <span>Back</span>\n    </button>\n    <button data-id="').concat(t.id,'" class="button button__add-to-library">Add to library</button>\n  </div>').toString();popularFilmsData.flag=!0,renderDetailsFilm(e),document.querySelector(".button__add-to-library").addEventListener("click",addToLibrary)}function addToLibrary(t){var e=t.target.getAttribute("data-id"),a=localStorage.getItem("library")||"",n=[e].concat(_toConsumableArray(a.split(",")));localStorage.setItem("library",n)}var refs={filmsList:document.querySelector(".films-list")};function clearList(){refs.filmsList.innerHTML="",pageRefs.detailsPage.innerHTML=""}var imgUrl="https://image.tmdb.org/t/p/w500";function parseData(t){renderList(t.map(function(t){return'<li class="films-list__item">\n          <img\n          class="films-list__image"\n            src="'.concat(imgUrl,"/").concat(t.poster_path,'"\n            data-id = "').concat(t.id,'"\n            alt="Here\'s how it looks!"\n          />\n          <h2 class="films-list__title">').concat(t.title,'</h2>\n          <span class="films-list__rate">').concat(t.vote_average,"</span>\n      </li>")}).join(""))}function renderLibrary(t){var e=t.map(function(t){return'<li class="films-list__item">\n            <img\n            class="films-list__image"\n              src="'.concat(imgUrl).concat(t.poster_path?t.poster_path:t.backdrop_path,'"\n              alt="Here\'s how it looks!"\n              width="298"\n              height="156"/>\n            <p class="films-list__title">').concat(t.title,"</p>\n        </li>")}).join("");popularFilmsData.copyDomElement=popularityRefs.libraryListLi.cloneNode(!0),popularityRefs.libraryListLi.insertAdjacentHTML("afterbegin",e)}function renderList(t){clearList(),popularityRefs.filmsList.insertAdjacentHTML("afterbegin",t)}function renderDetailsFilm(t){clearList(),popularityRefs.detailsPage.insertAdjacentHTML("afterbegin",t),popularityRefs.homePage.classList.add("hidden"),popularityRefs.detailsPage.classList.toggle("hidden"),popularityRefs.libraryPage.classList.add("hidden")}